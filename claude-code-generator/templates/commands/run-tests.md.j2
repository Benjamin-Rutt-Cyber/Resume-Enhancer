# Run Tests

Execute the test suite for {{ project_name }} to ensure code quality and correctness.

## Quick Test Commands

### Backend Tests

{% if backend_framework and 'python' in backend_framework %}
```bash
# Run all tests with pytest
cd backend
pytest

# Run with coverage report
pytest --cov=app --cov-report=html --cov-report=term

# Run specific test file
pytest tests/test_api.py

# Run tests matching pattern
pytest -k "test_auth"

# Run with verbose output
pytest -v

# Run and stop on first failure
pytest -x
```
{% elif backend_framework and 'node' in backend_framework %}
```bash
# Run all tests with Jest
cd backend
npm test

# Run with coverage
npm test -- --coverage

# Run specific test file
npm test -- tests/api.test.js

# Run in watch mode
npm test -- --watch

# Update snapshots
npm test -- -u
```
{% elif backend_framework and 'django' in backend_framework %}
```bash
# Run all tests with Django
cd backend
python manage.py test

# Run specific app tests
python manage.py test app.tests

# Run with coverage
coverage run --source='.' manage.py test
coverage report
coverage html

# Keep test database
python manage.py test --keepdb
```
{% endif %}

{% if frontend_framework %}
### Frontend Tests

{% if 'react' in frontend_framework or 'vue' in frontend_framework %}
```bash
# Run frontend tests
cd frontend
npm test

# Run with coverage
npm test -- --coverage

# Run in watch mode
npm test -- --watch

# Run E2E tests (if configured)
npm run test:e2e
```
{% endif %}

{% if 'react-native' in frontend_framework %}
```bash
# Run React Native tests
cd mobile
npm test

# Run with coverage
npm test -- --coverage

# Run on specific platform
npm test -- --platform=ios
npm test -- --platform=android
```
{% endif %}
{% endif %}

## Comprehensive Test Suite

### Run All Tests

```bash
{% if backend_framework and 'python' in backend_framework %}
# Backend tests
cd backend
pytest

{% endif %}
{% if frontend_framework and frontend_framework != 'react-native' %}
# Frontend tests
cd ../frontend
npm test -- --watchAll=false

{% endif %}
{% if frontend_framework and 'react-native' in frontend_framework %}
# Mobile tests
cd mobile
npm test -- --watchAll=false

{% endif %}
# Return to project root
cd ..
```

### Run with Coverage

```bash
{% if backend_framework and 'python' in backend_framework %}
# Backend coverage
cd backend
pytest --cov=app --cov-report=html --cov-report=term-missing

{% endif %}
{% if frontend_framework %}
# Frontend coverage
cd {% if frontend_framework == 'react-native' %}mobile{% else %}frontend{% endif %}

npm test -- --coverage --watchAll=false
cd ..
{% endif %}

# View coverage reports
# Backend: open backend/htmlcov/index.html
# Frontend: open {% if frontend_framework == 'react-native' %}mobile{% else %}frontend{% endif %}/coverage/lcov-report/index.html
```

## Test Types

### Unit Tests
Test individual functions and components in isolation.

{% if backend_framework and 'python' in backend_framework %}
```bash
# Run unit tests only
pytest tests/unit/
```
{% elif backend_framework and 'node' in backend_framework %}
```bash
# Run unit tests only
npm test -- tests/unit
```
{% endif %}

### Integration Tests
Test interactions between components and external services.

{% if backend_framework and 'python' in backend_framework %}
```bash
# Run integration tests
pytest tests/integration/
```
{% elif backend_framework and 'node' in backend_framework %}
```bash
# Run integration tests
npm test -- tests/integration
```
{% endif %}

### End-to-End Tests
Test complete user workflows through the application.

{% if frontend_framework %}
```bash
{% if 'react-native' in frontend_framework %}
# Run E2E tests with Detox
cd mobile
npm run test:e2e:ios
npm run test:e2e:android
{% else %}
# Run E2E tests with Cypress/Playwright
cd frontend
npm run test:e2e

# Run E2E in headed mode
npm run test:e2e:headed
{% endif %}
```
{% endif %}

## Continuous Integration

### Pre-commit Tests
Run before committing code:

```bash
{% if backend_framework and 'python' in backend_framework %}
# Quick backend tests
cd backend
pytest tests/unit/ -x

# Lint code
black . --check
flake8 .

{% endif %}
{% if frontend_framework %}
# Quick frontend tests
cd {% if frontend_framework == 'react-native' %}mobile{% else %}frontend{% endif %}

npm run lint
npm test -- --watchAll=false --bail

{% endif %}
```

### Full CI Pipeline
What runs in CI/CD:

```bash
# Install dependencies
# Run linters
# Run all tests with coverage
# Check coverage thresholds
# Build application
# Run security scans
```

## Test Configuration

### Backend Test Config

{% if backend_framework and 'python' in backend_framework %}
**File:** `backend/pytest.ini`
```ini
[pytest]
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*
addopts =
    --strict-markers
    --cov=app
    --cov-report=term-missing
    --cov-report=html
    --cov-fail-under=80
```

**File:** `backend/.coveragerc`
```ini
[run]
source = app
omit =
    */tests/*
    */migrations/*
    */__pycache__/*

[report]
exclude_lines =
    pragma: no cover
    def __repr__
    raise AssertionError
    raise NotImplementedError
    if __name__ == .__main__.:
```
{% endif %}

### Frontend Test Config

{% if frontend_framework %}
**File:** `{% if frontend_framework == 'react-native' %}mobile{% else %}frontend{% endif %}/jest.config.js`
```javascript
module.exports = {
  testEnvironment: 'jsdom',
  collectCoverageFrom: [
    'src/**/*.{js,jsx,ts,tsx}',
    '!src/**/*.d.ts',
    '!src/index.tsx',
  ],
  coverageThresholds: {
    global: {
      branches: 80,
      functions: 80,
      lines: 80,
      statements: 80
    }
  }
};
```
{% endif %}

## Debugging Failed Tests

### View Detailed Output

```bash
{% if backend_framework and 'python' in backend_framework %}
# Verbose pytest output
pytest -vv

# Show print statements
pytest -s

# Drop into debugger on failure
pytest --pdb
{% elif backend_framework and 'node' in backend_framework %}
# Verbose Jest output
npm test -- --verbose

# Run single test file
npm test -- path/to/test.js

# Debug with Node
node --inspect-brk node_modules/.bin/jest --runInBand
{% endif %}
```

### Common Test Failures

**Import errors:**
{% if backend_framework and 'python' in backend_framework %}
- Ensure virtual environment is activated
- Check PYTHONPATH includes project root
- Reinstall dependencies: `pip install -r requirements.txt`
{% elif backend_framework and 'node' in backend_framework %}
- Clear node_modules: `rm -rf node_modules && npm install`
- Clear Jest cache: `npm test -- --clearCache`
{% endif %}

**Database errors:**
{% if database %}
- Ensure test database is created
- Check database connection in test config
- Run migrations: `/db-migrate`
{% endif %}

**Timeout errors:**
- Increase timeout in test config
- Check for async/await issues
- Look for hanging promises or connections

## Test Data Management

{% if database == 'postgresql' or database == 'mysql' %}
### Database Test Fixtures

{% if backend_framework and 'python' in backend_framework %}
```python
# conftest.py
import pytest
from app.database import init_db

@pytest.fixture
def db_session():
    """Provide clean database for each test."""
    init_db()
    yield
    # Cleanup after test
```
{% elif backend_framework and 'node' in backend_framework %}
```javascript
// test/setup.js
beforeEach(async () => {
  await db.sync({ force: true });
  await seedTestData();
});

afterEach(async () => {
  await db.drop();
});
```
{% endif %}
{% endif %}

### Mock External Services

```bash
# Use mock server for external APIs
# Mock payment gateway responses
# Mock email service
```

## Performance Testing

{% if backend_framework %}
```bash
{% if 'python' in backend_framework %}
# Load testing with locust
cd backend
locust -f tests/load/locustfile.py

{% elif 'node' in backend_framework %}
# Load testing with artillery
npm run test:load

{% endif %}
```
{% endif %}

## Test Reports

### Generate HTML Report

```bash
{% if backend_framework and 'python' in backend_framework %}
# Generate pytest HTML report
pytest --html=report.html --self-contained-html

{% elif backend_framework and 'node' in backend_framework %}
# Jest automatically generates HTML coverage report
npm test -- --coverage
# View at: coverage/lcov-report/index.html

{% endif %}
```

### View Coverage

```bash
{% if backend_framework and 'python' in backend_framework %}
# Terminal coverage report
pytest --cov=app --cov-report=term-missing

# HTML coverage report
pytest --cov=app --cov-report=html
# Open: htmlcov/index.html

{% elif backend_framework and 'node' in backend_framework %}
# Coverage report
npm test -- --coverage
# Open: coverage/lcov-report/index.html

{% endif %}
```

## Best Practices

1. **Write Tests First (TDD)**
   - Define expected behavior
   - Write failing test
   - Implement feature
   - Verify test passes

2. **Keep Tests Fast**
   - Mock external services
   - Use in-memory databases for unit tests
   - Parallelize test execution

3. **Test Coverage Goals**
   - Aim for 80%+ coverage
   - Focus on critical paths
   - Don't obsess over 100%

4. **Isolate Tests**
   - Each test should be independent
   - Use fixtures/factories for setup
   - Clean up after each test

5. **Descriptive Test Names**
   - test_user_login_with_valid_credentials
   - test_api_returns_404_for_missing_resource
   - test_payment_fails_with_invalid_card

## Troubleshooting

### Tests Pass Locally but Fail in CI

- Check environment variables
- Verify dependency versions match
- Look for timing/race conditions
- Check for file system differences

### Slow Test Suite

{% if backend_framework and 'python' in backend_framework %}
```bash
# Profile slow tests
pytest --durations=10

# Run tests in parallel
pytest -n auto  # requires pytest-xdist
```
{% elif backend_framework and 'node' in backend_framework %}
```bash
# Run tests in parallel
npm test -- --maxWorkers=4

# Identify slow tests
npm test -- --verbose
```
{% endif %}

### Flaky Tests

- Identify timing dependencies
- Add proper waits/retries
- Check for shared state
- Run test 100 times: {% if backend_framework and 'python' in backend_framework %}`pytest --count=100`{% else %}`npm test -- --repeat=100`{% endif %}

## Next Steps

After running tests:
- Fix any failing tests immediately
- Review coverage reports for gaps
- Add tests for new features
- Update CI/CD pipeline if needed
- Run `/deploy` once all tests pass

Tests are passing for {{ project_name }}! ðŸŽ‰
